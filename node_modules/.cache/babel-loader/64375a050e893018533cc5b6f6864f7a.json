{"ast":null,"code":"import _regeneratorRuntime from \"/Users/ch4rly/Documents/code/spot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/ch4rly/Documents/code/spot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/ch4rly/Documents/code/spot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/ch4rly/Documents/code/spot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/ch4rly/Documents/code/spot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ch4rly/Documents/code/spot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/ch4rly/Documents/code/spot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/ch4rly/Documents/code/spot/src/App.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport NetworksList from './components/networks_list';\nimport BalanceButton from './components/balance_button';\nimport ConnectedSnackBar from './components/connected_snackbar';\nimport DisconnectedSnackBar from './components/disconnected_snackbar';\nimport Web3 from 'web3';\nimport { openPaymentChannel, closePaymentChannel, submitPayment, joinTokenNetwork, getExistingPartners, leaveTokenNetwork } from './helpers/payment';\nvar style = {\n  margin: 0,\n  top: 'auto',\n  right: 20,\n  bottom: 20,\n  left: 'auto',\n  position: 'fixed'\n};\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, App);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(App)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      networks: [],\n      partners: {},\n      tokenAddress: '0x396764f15ed1467883A9a5B7D42AcFb788CD1826',\n      partnerAddress: '0x5Ed1E563C6917411cB667179764C05112f0DE7B9',\n      pricePerChunk: .001,\n      account: undefined,\n      connectedNetwork: undefined,\n      balance: 0,\n      connectedSnackBarOpen: false,\n      disconnectedSnackBarOpen: false,\n      kBytesConsumed: 0,\n      moneySpent: 0\n    };\n\n    _this.payForChunks =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(size) {\n        var kBytesConsumed, moneySpent, balance, res;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                kBytesConsumed = _this.state.kBytesConsumed + size;\n                moneySpent = _this.state.moneySpent + _this.state.pricePerChunk;\n                balance = _this.state.balance - _this.state.pricePerChunk;\n                balance = balance.toFixed(3);\n\n                _this.setState({\n                  kBytesConsumed: kBytesConsumed,\n                  moneySpent: moneySpent,\n                  balance: balance\n                });\n\n                res = submitPayment(_this.state.partnerAddress, _this.state.tokenAddress, _this.state.pricePerChunk);\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.closePaymentChannel =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return closePaymentChannel(_this.state.partnerAddress, _this.state.tokenAddress);\n\n            case 2:\n              res = _context2.sent;\n              console.log(res, \"closed payment channel\");\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    _this.leaveTokenNetwork =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return leaveTokenNetwork(_this.state.tokenAddress);\n\n            case 2:\n              res = _context3.sent;\n              console.log(res, \"network left\");\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n    _this.sendMoney =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee4() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return submitPayment(_this.state.partnerAddress, _this.state.tokenAddress, .001);\n\n            case 2:\n              res = _context4.sent;\n              console.log(res, \"money sent\");\n\n            case 4:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n    _this.joinTokenNetwork =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee5() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return joinTokenNetwork();\n\n            case 2:\n              res = _context5.sent;\n              console.log(\"token network joined\", res);\n\n            case 4:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n    _this.getExistingPartners =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee6() {\n      var partners;\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return getExistingPartners();\n\n            case 2:\n              partners = _context6.sent;\n              console.log(\"here are your partners\", partners);\n\n            case 4:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6);\n    }));\n    _this.getTokenBalance =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee7() {\n      var web3, account, weiBalance, ethBalance, balance;\n      return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              web3 = new Web3(new Web3.providers.HttpProvider('http://127.0.0.1:8545'));\n              _context7.next = 3;\n              return web3.eth.getAccounts();\n\n            case 3:\n              account = _context7.sent;\n              _context7.next = 6;\n              return web3.eth.getBalance(account[0]);\n\n            case 6:\n              weiBalance = _context7.sent;\n              ethBalance = web3.utils.fromWei(weiBalance);\n              balance = (ethBalance / 0.005449266175824176).toFixed(3);\n\n              _this.setState({\n                balance: balance\n              });\n\n            case 10:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7);\n    }));\n    _this.loadData =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee8() {\n      var networks;\n      return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              networks = [];\n              _context8.prev = 1;\n              _context8.next = 4;\n              return window.spot.findSpots();\n\n            case 4:\n              networks = _context8.sent;\n              _context8.next = 10;\n              break;\n\n            case 7:\n              _context8.prev = 7;\n              _context8.t0 = _context8[\"catch\"](1);\n              console.log('error failed to load networks', _context8.t0);\n\n            case 10:\n              _this.setState({\n                networks: networks\n              });\n\n            case 11:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8, null, [[1, 7]]);\n    }));\n\n    _this.loadNetworks = function () {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114\n        },\n        __self: this\n      }, React.createElement(NetworksList, {\n        kBytesConsumed: _this.state.kBytesConsumed,\n        moneySpent: _this.state.moneySpent,\n        networks: _this.state.networks,\n        connectToNetwork: _this.connectToNetwork,\n        disconnectFromNetwork: _this.disconnectFromNetwork,\n        connectedNetwork: _this.state.connectedNetwork,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115\n        },\n        __self: this\n      }));\n    };\n\n    _this.connectToNetwork =\n    /*#__PURE__*/\n    function () {\n      var _ref9 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee9(networkId) {\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _this.setState({\n                  connectedNetwork: networkId,\n                  connectedSnackBarOpen: true,\n                  disconnectedSnackBarOpen: false\n                });\n\n                _this.hideConnectedSnackBar();\n\n                window.spot.connectToSpot();\n                openPaymentChannel(_this.state.partnerAddress, _this.state.tokenAddress, 20, 500);\n\n              case 4:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9);\n      }));\n\n      return function (_x2) {\n        return _ref9.apply(this, arguments);\n      };\n    }();\n\n    _this.disconnectFromNetwork =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee10() {\n      return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n        while (1) {\n          switch (_context10.prev = _context10.next) {\n            case 0:\n              // Avoiding for now due to Raiden waiting time of 500 blocks\n              // await this.closePaymentChannel()\n              _this.setState({\n                connectedNetwork: undefined,\n                connectedSnackBarOpen: false,\n                disconnectedSnackBarOpen: true,\n                kBytesConsumed: 0,\n                moneySpoent: 0\n              });\n\n              _this.hideDisconnectedSnackBar();\n\n            case 2:\n            case \"end\":\n              return _context10.stop();\n          }\n        }\n      }, _callee10);\n    }));\n\n    _this.hideConnectedSnackBar = function () {\n      setTimeout(function () {\n        _this.setState({\n          connectedSnackBarOpen: false\n        });\n      }, 3000);\n    };\n\n    _this.hideDisconnectedSnackBar = function () {\n      setTimeout(function () {\n        _this.setState({\n          disconnectedSnackBarOpen: false\n        });\n      }, 3000);\n    };\n\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.init();\n    }\n  }, {\n    key: \"init\",\n    value: function () {\n      var _init = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee11() {\n        return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                // await window.spot.disconnectFromSpot()\n                window.spot.on('PAYMENT_TRIGGERED', this.payForChunks);\n                _context11.next = 3;\n                return this.loadData();\n\n              case 3:\n                _context11.next = 5;\n                return this.getTokenBalance();\n\n              case 5:\n                _context11.next = 7;\n                return this.joinTokenNetwork();\n\n              case 7:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function init() {\n        return _init.apply(this, arguments);\n      }\n\n      return init;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        className: \"App\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157\n        },\n        __self: this\n      }, React.createElement(\"header\", {\n        className: \"App-header\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      }, React.createElement(BalanceButton, {\n        balance: this.state.balance,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159\n        },\n        __self: this\n      }), this.loadNetworks(), React.createElement(ConnectedSnackBar, {\n        open: this.state.connectedSnackBarOpen,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        },\n        __self: this\n      }), React.createElement(DisconnectedSnackBar, {\n        open: this.state.disconnectedSnackBarOpen,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default App;","map":{"version":3,"sources":["/Users/ch4rly/Documents/code/spot/src/App.js"],"names":["React","Component","NetworksList","BalanceButton","ConnectedSnackBar","DisconnectedSnackBar","Web3","openPaymentChannel","closePaymentChannel","submitPayment","joinTokenNetwork","getExistingPartners","leaveTokenNetwork","style","margin","top","right","bottom","left","position","App","state","networks","partners","tokenAddress","partnerAddress","pricePerChunk","account","undefined","connectedNetwork","balance","connectedSnackBarOpen","disconnectedSnackBarOpen","kBytesConsumed","moneySpent","payForChunks","size","toFixed","setState","res","console","log","sendMoney","getTokenBalance","web3","providers","HttpProvider","eth","getAccounts","getBalance","weiBalance","ethBalance","utils","fromWei","loadData","window","spot","findSpots","loadNetworks","connectToNetwork","disconnectFromNetwork","networkId","hideConnectedSnackBar","connectToSpot","moneySpoent","hideDisconnectedSnackBar","setTimeout","init","on"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport './App.css'\nimport NetworksList from './components/networks_list'\nimport BalanceButton from './components/balance_button'\nimport ConnectedSnackBar from './components/connected_snackbar'\nimport DisconnectedSnackBar from './components/disconnected_snackbar'\nimport Web3 from 'web3'\n\nimport {\n  openPaymentChannel,\n  closePaymentChannel,\n  submitPayment,\n  joinTokenNetwork,\n  getExistingPartners,\n  leaveTokenNetwork\n} from './helpers/payment'\n\nconst style = {\n  margin: 0,\n  top: 'auto',\n  right: 20,\n  bottom: 20,\n  left: 'auto',\n  position: 'fixed',\n}\n\nclass App extends Component {\n\n  state = {\n    networks: [],\n    partners: {},\n    tokenAddress: '0x396764f15ed1467883A9a5B7D42AcFb788CD1826',\n    partnerAddress: '0x5Ed1E563C6917411cB667179764C05112f0DE7B9',\n    pricePerChunk: .001,\n    account: undefined,\n    connectedNetwork: undefined,\n    balance: 0,\n    connectedSnackBarOpen: false,\n    disconnectedSnackBarOpen: false,\n    kBytesConsumed:0,\n    moneySpent:0\n  }\n\n  componentDidMount () {\n    this.init()    \n  }\n\n  async init() {\n    // await window.spot.disconnectFromSpot()\n    window.spot.on('PAYMENT_TRIGGERED', this.payForChunks)\n    await this.loadData()\n    await this.getTokenBalance()\n    // await this.leaveTokenNetwork()\n    await this.joinTokenNetwork()\n    // await this.getExistingPartners()\n  }\n\n    payForChunks = async (size) => {\n    const kBytesConsumed = this.state.kBytesConsumed + size\n    const moneySpent = this.state.moneySpent + this.state.pricePerChunk\n    let balance = this.state.balance - this.state.pricePerChunk\n    balance = balance.toFixed(3)\n    this.setState({ kBytesConsumed, moneySpent, balance })\n    let res = submitPayment(this.state.partnerAddress, this.state.tokenAddress, this.state.pricePerChunk)\n  }\n\n    closePaymentChannel = async () => {\n    let res = await closePaymentChannel(this.state.partnerAddress, this.state.tokenAddress)\n    console.log(res, \"closed payment channel\")\n  }\n\n  leaveTokenNetwork = async () =>{\n    let res = await leaveTokenNetwork(this.state.tokenAddress)\n    console.log(res, \"network left\")\n  }\n\n    sendMoney = async () => {\n    let res = await submitPayment(this.state.partnerAddress, this.state.tokenAddress, .001)\n    console.log(res, \"money sent\")\n  }\n  \n    joinTokenNetwork = async () => {\n    let res = await joinTokenNetwork()\n    console.log(\"token network joined\", res)\n  }\n\n    getExistingPartners = async () => {\n    const partners = await getExistingPartners()\n    console.log(\"here are your partners\", partners)\n  }\n\n  getTokenBalance = async () => {\n    const web3 = new Web3(new Web3.providers.HttpProvider('http://127.0.0.1:8545'))\n    const account = await web3.eth.getAccounts()\n    const weiBalance = await web3.eth.getBalance(account[0])\n    const ethBalance = web3.utils.fromWei(weiBalance)\n    const balance = (ethBalance/0.005449266175824176).toFixed(3)\n    this.setState({ balance })\n  }\n\n  loadData = async () => {\n\n    let networks = []\n    try {\n      networks = await window.spot.findSpots()    \n    } catch (error) {\n      console.log('error failed to load networks', error)\n    }\n    this.setState({ networks })\n  }\n\n  loadNetworks = () =>  {\n    return (\n      <div>\n      <NetworksList kBytesConsumed = {this.state.kBytesConsumed} moneySpent = {this.state.moneySpent} networks={ this.state.networks } connectToNetwork = {this.connectToNetwork} disconnectFromNetwork = {this.disconnectFromNetwork} connectedNetwork = { this.state.connectedNetwork} />\n      </div>\n    )\n  }\n\nconnectToNetwork = async (networkId) => {\n  this.setState({ \n    connectedNetwork : networkId,\n    connectedSnackBarOpen : true,\n    disconnectedSnackBarOpen : false,\n  })\n  this.hideConnectedSnackBar()\n  window.spot.connectToSpot()\n  openPaymentChannel(this.state.partnerAddress, this.state.tokenAddress, 20, 500)\n}\n\ndisconnectFromNetwork = async () => {\n  // Avoiding for now due to Raiden waiting time of 500 blocks\n  // await this.closePaymentChannel()\n  this.setState({ \n    connectedNetwork : undefined,\n    connectedSnackBarOpen : false,\n    disconnectedSnackBarOpen : true,\n    kBytesConsumed: 0,\n    moneySpoent: 0 })\n  this.hideDisconnectedSnackBar()\n}\n\nhideConnectedSnackBar = () => {\n  setTimeout(() => { \n    this.setState ({ connectedSnackBarOpen : false })\n  }, 3000)  \n}\n\nhideDisconnectedSnackBar = () => {\n  setTimeout(() => { \n    this.setState ({ disconnectedSnackBarOpen : false })\n  }, 3000)  \n}\n\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n        <BalanceButton balance = { this.state.balance}/>\n        { this.loadNetworks() }\n        <ConnectedSnackBar open = {this.state.connectedSnackBarOpen}/>\n        <DisconnectedSnackBar open = {this.state.disconnectedSnackBarOpen}/>\n        </header>\n      </div>\n    )\n  }\n}\n\nexport default App\n"]},"metadata":{},"sourceType":"module"}