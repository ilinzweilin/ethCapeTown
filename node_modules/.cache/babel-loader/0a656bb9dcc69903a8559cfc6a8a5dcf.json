{"ast":null,"code":"import _regeneratorRuntime from \"/Users/ch4rly/Documents/code/spot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/ch4rly/Documents/code/spot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/ch4rly/Documents/code/spot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/ch4rly/Documents/code/spot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/ch4rly/Documents/code/spot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ch4rly/Documents/code/spot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/ch4rly/Documents/code/spot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/ch4rly/Documents/code/spot/src/App.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport NetworksList from './components/networks_list';\nimport BalanceButton from './components/balance_button';\nimport ConnectedSnackBar from './components/connected_snackbar';\nimport DisconnectedSnackBar from './components/disconnected_snackbar';\nimport Web3 from 'web3';\nimport ChannelButton from './components/open_channel';\nimport { openPaymentChannel, closePaymentChannel as _closePaymentChannel, submitPayment, joinTokenNetwork as _joinTokenNetwork, getExistingPartners as _getExistingPartners, leaveTokenNetwork as _leaveTokenNetwork } from './helpers/payment';\nvar style = {\n  margin: 0,\n  top: 'auto',\n  right: 20,\n  bottom: 20,\n  left: 'auto',\n  position: 'fixed'\n};\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, App);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(App)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      networks: [],\n      partners: {},\n      tokenAddress: '0x396764f15ed1467883A9a5B7D42AcFb788CD1826',\n      partnerAddress: '0x5Ed1E563C6917411cB667179764C05112f0DE7B9',\n      pricePerChunk: .01,\n      account: undefined,\n      connectedNetwork: undefined,\n      balance: 0,\n      connectedSnackBarOpen: false,\n      disconnectedSnackBarOpen: false,\n      kBytesConsumed: 0,\n      moneySpent: 0\n    };\n    _this.getTokenBalance =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var web3, account, weiBalance, ethBalance, balance;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              web3 = new Web3(new Web3.providers.HttpProvider('http://127.0.0.1:8545'));\n              _context.next = 3;\n              return web3.eth.getAccounts();\n\n            case 3:\n              account = _context.sent;\n              _context.next = 6;\n              return web3.eth.getBalance(account[0]);\n\n            case 6:\n              weiBalance = _context.sent;\n              ethBalance = web3.utils.fromWei(weiBalance);\n              balance = (ethBalance / 0.005449266175824176).toFixed(3);\n\n              _this.setState({\n                balance: balance\n              });\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    _this.loadData =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var networks;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              networks = [];\n              _context2.prev = 1;\n              _context2.next = 4;\n              return window.spot.findSpots();\n\n            case 4:\n              networks = _context2.sent;\n              _context2.next = 10;\n              break;\n\n            case 7:\n              _context2.prev = 7;\n              _context2.t0 = _context2[\"catch\"](1);\n              console.log('error failed to load networks', _context2.t0);\n\n            case 10:\n              _this.setState({\n                networks: networks\n              });\n\n            case 11:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 7]]);\n    }));\n\n    _this.loadNetworks = function () {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120\n        },\n        __self: this\n      }, React.createElement(NetworksList, {\n        kBytesConsumed: _this.state.kBytesConsumed,\n        moneySpent: _this.state.moneySpent,\n        networks: _this.state.networks,\n        connectToNetwork: _this.connectToNetwork,\n        disconnectFromNetwork: _this.disconnectFromNetwork,\n        connectedNetwork: _this.state.connectedNetwork,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121\n        },\n        __self: this\n      }));\n    };\n\n    _this.connectToNetwork =\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(networkId) {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return window.spot.connectToSpot();\n\n              case 2:\n                _context3.next = 4;\n                return _this.openPaymentChannel();\n\n              case 4:\n                _this.setState({\n                  connectedNetwork: networkId,\n                  connectedSnackBarOpen: true,\n                  disconnectedSnackBarOpen: false\n                });\n\n                _this.hideConnectedSnackBar();\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.disconnectFromNetwork =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee4() {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              // Avoiding for now due to Raiden waiting time of 500 blocks\n              // await this.closePaymentChannel()\n              _this.setState({\n                connectedNetwork: undefined,\n                connectedSnackBarOpen: false,\n                disconnectedSnackBarOpen: true,\n                kBytesConsumed: 0,\n                moneySpoent: 0\n              });\n\n              _this.hideDisconnectedSnackBar();\n\n            case 2:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    _this.hideConnectedSnackBar = function () {\n      setTimeout(function () {\n        _this.setState({\n          connectedSnackBarOpen: false\n        });\n      }, 3000);\n    };\n\n    _this.hideDisconnectedSnackBar = function () {\n      setTimeout(function () {\n        _this.setState({\n          disconnectedSnackBarOpen: false\n        });\n      }, 3000);\n    };\n\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.init();\n    }\n  }, {\n    key: \"init\",\n    value: function () {\n      var _init = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5() {\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                // await window.spot.disconnectFromSpot()\n                window.spot.on('PAYMENT_TRIGGERED', this.payForChunks);\n                _context5.next = 3;\n                return this.loadData();\n\n              case 3:\n                _context5.next = 5;\n                return this.getTokenBalance();\n\n              case 5:\n                _context5.next = 7;\n                return this.joinTokenNetwork();\n\n              case 7:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function init() {\n        return _init.apply(this, arguments);\n      }\n\n      return init;\n    }()\n  }, {\n    key: \"openPaymentChannel\",\n    value: function () {\n      var _openPaymentChannel = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee6() {\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                try {\n                  console.log(\"opened\", res);\n                } catch (err) {\n                  console.log(err, \"opening failed\");\n                }\n\n              case 1:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      }));\n\n      function openPaymentChannel() {\n        return _openPaymentChannel.apply(this, arguments);\n      }\n\n      return openPaymentChannel;\n    }()\n  }, {\n    key: \"payForChunks\",\n    value: function () {\n      var _payForChunks = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee7(size) {\n        var res, kBytesConsumed, moneySpent;\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return submitPayment(this.state.partnerAddress, this.state.tokenAddress, this.state.pricePerChunk);\n\n              case 2:\n                res = _context7.sent;\n                kBytesConsumed = this.state.kBytesConsumed + size;\n                moneySpent = this.state.moneySpent + this.state.pricePerChunk;\n                this.setState({\n                  kBytesConsumed: kBytesConsumed,\n                  moneySpent: moneySpent\n                });\n\n              case 6:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function payForChunks(_x2) {\n        return _payForChunks.apply(this, arguments);\n      }\n\n      return payForChunks;\n    }()\n  }, {\n    key: \"closePaymentChannel\",\n    value: function () {\n      var _closePaymentChannel2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee8() {\n        var res;\n        return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _context8.next = 2;\n                return _closePaymentChannel(this.state.partnerAddress, '0x396764f15ed1467883A9a5B7D42AcFb788CD1826');\n\n              case 2:\n                res = _context8.sent;\n                console.log(res, \"closed payment channel\");\n\n              case 4:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function closePaymentChannel() {\n        return _closePaymentChannel2.apply(this, arguments);\n      }\n\n      return closePaymentChannel;\n    }()\n  }, {\n    key: \"leaveTokenNetwork\",\n    value: function () {\n      var _leaveTokenNetwork2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee9() {\n        var res;\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.next = 2;\n                return _leaveTokenNetwork('0x396764f15ed1467883A9a5B7D42AcFb788CD1826');\n\n              case 2:\n                res = _context9.sent;\n                console.log(res, \"network left\");\n\n              case 4:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9);\n      }));\n\n      function leaveTokenNetwork() {\n        return _leaveTokenNetwork2.apply(this, arguments);\n      }\n\n      return leaveTokenNetwork;\n    }()\n  }, {\n    key: \"sendMoney\",\n    value: function () {\n      var _sendMoney = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee10() {\n        var res;\n        return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                _context10.next = 2;\n                return submitPayment(this.state.partnerAddress, '0x396764f15ed1467883A9a5B7D42AcFb788CD1826', 1);\n\n              case 2:\n                res = _context10.sent;\n                console.log(res, \"money sent\");\n\n              case 4:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function sendMoney() {\n        return _sendMoney.apply(this, arguments);\n      }\n\n      return sendMoney;\n    }()\n  }, {\n    key: \"joinTokenNetwork\",\n    value: function () {\n      var _joinTokenNetwork2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee11() {\n        var res;\n        return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                _context11.next = 2;\n                return _joinTokenNetwork();\n\n              case 2:\n                res = _context11.sent;\n                console.log(\"token network joined\", res);\n\n              case 4:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11);\n      }));\n\n      function joinTokenNetwork() {\n        return _joinTokenNetwork2.apply(this, arguments);\n      }\n\n      return joinTokenNetwork;\n    }()\n  }, {\n    key: \"getExistingPartners\",\n    value: function () {\n      var _getExistingPartners2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee12() {\n        var partners;\n        return _regeneratorRuntime.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                _context12.next = 2;\n                return _getExistingPartners();\n\n              case 2:\n                partners = _context12.sent;\n                console.log(\"here are your partners\", partners);\n\n              case 4:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12);\n      }));\n\n      function getExistingPartners() {\n        return _getExistingPartners2.apply(this, arguments);\n      }\n\n      return getExistingPartners;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        className: \"App\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      }, React.createElement(\"header\", {\n        className: \"App-header\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164\n        },\n        __self: this\n      }, this.loadNetworks(), React.createElement(ConnectedSnackBar, {\n        open: this.state.connectedSnackBarOpen,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166\n        },\n        __self: this\n      }), React.createElement(DisconnectedSnackBar, {\n        open: this.state.disconnectedSnackBarOpen,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167\n        },\n        __self: this\n      })), React.createElement(BalanceButton, {\n        balance: this.state.balance,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default App;","map":{"version":3,"sources":["/Users/ch4rly/Documents/code/spot/src/App.js"],"names":["React","Component","NetworksList","BalanceButton","ConnectedSnackBar","DisconnectedSnackBar","Web3","ChannelButton","openPaymentChannel","closePaymentChannel","submitPayment","joinTokenNetwork","getExistingPartners","leaveTokenNetwork","style","margin","top","right","bottom","left","position","App","state","networks","partners","tokenAddress","partnerAddress","pricePerChunk","account","undefined","connectedNetwork","balance","connectedSnackBarOpen","disconnectedSnackBarOpen","kBytesConsumed","moneySpent","getTokenBalance","web3","providers","HttpProvider","eth","getAccounts","getBalance","weiBalance","ethBalance","utils","fromWei","toFixed","setState","loadData","window","spot","findSpots","console","log","loadNetworks","connectToNetwork","disconnectFromNetwork","networkId","connectToSpot","hideConnectedSnackBar","moneySpoent","hideDisconnectedSnackBar","setTimeout","init","on","payForChunks","res","err","size"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport './App.css'\nimport NetworksList from './components/networks_list'\nimport BalanceButton from './components/balance_button'\nimport ConnectedSnackBar from './components/connected_snackbar'\nimport DisconnectedSnackBar from './components/disconnected_snackbar'\nimport Web3 from 'web3'\nimport ChannelButton from './components/open_channel';\nimport {\n  openPaymentChannel,\n  closePaymentChannel,\n  submitPayment,\n  joinTokenNetwork,\n  getExistingPartners,\n  leaveTokenNetwork\n} from './helpers/payment'\n\nconst style = {\n  margin: 0,\n  top: 'auto',\n  right: 20,\n  bottom: 20,\n  left: 'auto',\n  position: 'fixed',\n}\n\nclass App extends Component {\n\n  state = {\n    networks: [],\n    partners: {},\n    tokenAddress: '0x396764f15ed1467883A9a5B7D42AcFb788CD1826',\n    partnerAddress: '0x5Ed1E563C6917411cB667179764C05112f0DE7B9',\n    pricePerChunk: .01,\n    account: undefined,\n    connectedNetwork: undefined,\n    balance: 0,\n    connectedSnackBarOpen: false,\n    disconnectedSnackBarOpen: false,\n    kBytesConsumed:0,\n    moneySpent:0\n  }\n\n  componentDidMount () {\n    this.init()    \n  }\n\n  async init() {\n    // await window.spot.disconnectFromSpot()\n    window.spot.on('PAYMENT_TRIGGERED', this.payForChunks)\n    await this.loadData()\n    await this.getTokenBalance()\n    // await this.leaveTokenNetwork()\n    await this.joinTokenNetwork()\n    // await this.getExistingPartners()\n  }\n\n  async openPaymentChannel() {\n    try {\n      console.log(\"opened\", res)\n    } catch (err) {\n      console.log(err, \"opening failed\")\n    }\n  }\n\n  async payForChunks(size) {\n    let res = await submitPayment(this.state.partnerAddress, this.state.tokenAddress, this.state.pricePerChunk)\n    const kBytesConsumed = this.state.kBytesConsumed + size\n    const moneySpent = this.state.moneySpent + this.state.pricePerChunk\n    this.setState({ kBytesConsumed, moneySpent })\n  }\n\n  async closePaymentChannel() {\n    let res = await closePaymentChannel(this.state.partnerAddress, '0x396764f15ed1467883A9a5B7D42AcFb788CD1826')\n    console.log(res, \"closed payment channel\")\n  }\n\n  async leaveTokenNetwork() {\n    let res = await leaveTokenNetwork('0x396764f15ed1467883A9a5B7D42AcFb788CD1826')\n    console.log(res, \"network left\")\n  }\n\n  async sendMoney() {\n    let res = await submitPayment(this.state.partnerAddress, '0x396764f15ed1467883A9a5B7D42AcFb788CD1826', 1)\n    console.log(res, \"money sent\")\n  }\n  \n  async joinTokenNetwork() {\n    let res = await joinTokenNetwork()\n    console.log(\"token network joined\", res)\n  }\n\n  async getExistingPartners() {\n    const partners = await getExistingPartners()\n    console.log(\"here are your partners\", partners)\n  }\n\n  getTokenBalance = async () => {\n    const web3 = new Web3(new Web3.providers.HttpProvider('http://127.0.0.1:8545'))\n    const account = await web3.eth.getAccounts()\n    const weiBalance = await web3.eth.getBalance(account[0])\n    const ethBalance = web3.utils.fromWei(weiBalance)\n    const balance = (ethBalance/0.005449266175824176).toFixed(3)\n    this.setState({ balance })\n  }\n\n  loadData = async () => {\n\n    let networks = []\n    try {\n      networks = await window.spot.findSpots()    \n    } catch (error) {\n      console.log('error failed to load networks', error)\n    }\n    this.setState({ networks })\n  }\n\n  loadNetworks = () =>  {\n    return (\n      <div>\n      <NetworksList kBytesConsumed = {this.state.kBytesConsumed} moneySpent = {this.state.moneySpent} networks={ this.state.networks } connectToNetwork = {this.connectToNetwork} disconnectFromNetwork = {this.disconnectFromNetwork} connectedNetwork = { this.state.connectedNetwork} />\n      </div>\n    )\n  }\n\nconnectToNetwork = async (networkId) => {\n  await window.spot.connectToSpot()\n  await this.openPaymentChannel()\n  this.setState({ \n    connectedNetwork : networkId,\n    connectedSnackBarOpen : true,\n    disconnectedSnackBarOpen : false,\n  })\n  this.hideConnectedSnackBar()\n}\n\ndisconnectFromNetwork = async () => {\n  // Avoiding for now due to Raiden waiting time of 500 blocks\n  // await this.closePaymentChannel()\n  this.setState({ \n    connectedNetwork : undefined,\n    connectedSnackBarOpen : false,\n    disconnectedSnackBarOpen : true,\n    kBytesConsumed: 0,\n    moneySpoent: 0 })\n  this.hideDisconnectedSnackBar()\n}\n\nhideConnectedSnackBar = () => {\n  setTimeout(() => { \n    this.setState ({ connectedSnackBarOpen : false })\n  }, 3000)  \n}\n\nhideDisconnectedSnackBar = () => {\n  setTimeout(() => { \n    this.setState ({ disconnectedSnackBarOpen : false })\n  }, 3000)  \n}\n\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n        { this.loadNetworks() }\n        <ConnectedSnackBar open = {this.state.connectedSnackBarOpen}/>\n        <DisconnectedSnackBar open = {this.state.disconnectedSnackBarOpen}/>\n        </header>\n        <BalanceButton balance = { this.state.balance}/>\n  \n      </div>\n    )\n  }\n}\n\nexport default App\n"]},"metadata":{},"sourceType":"module"}